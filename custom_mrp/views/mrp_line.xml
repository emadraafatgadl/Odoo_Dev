<?xml version="1.0" encoding="UTF-8"?>
<odoo>
	<record id="mrp_line_split_inherit" model="ir.ui.view">
        <field name="name">mrp.production.form.inherit</field>
        <field name="model">mrp.production</field>
        <field name="inherit_id" ref="mrp.mrp_production_form_view"/>
        <field name="arch" type="xml">
        	<xpath expr="//field[@name='bom_id']" position="after">
        		<field name="manufacturer_id"/>
        		<field name="customer_part_no"/>
        		<field name="description"/>
        	</xpath>
        	<xpath expr="//field[@name='date_deadline']" position="before">
			<field name="start_date_one" />
            <field name="start_date"/>
			<field name="reserved" invisible="1"/>
			<field name="reserved_check" invisible="1"/>
          </xpath>

		  <xpath expr="//sheet/div[@name='button_box']/button[2]" position="attributes">
			  <attribute name="attrs">{'invisible': ['|',('workorder_count', '=', 0),('reserved_check', '=', True)]}</attribute>
		  </xpath>

		  <xpath expr="//form/header/button[6]" position="attributes">
			  <attribute name="attrs">{'invisible': ['|', '|', '|', '|', ('state', '=', 'to_close'), ('is_locked', '=', False), ('reservation_state', '!=', 'assigned'), ('routing_id', '!=', False),('reserved_check', '=', True)]}</attribute>
		  </xpath>

		  <xpath expr="//form/header/button[7]" position="attributes">
			  <attribute name="attrs">{'invisible': ['|', '|', '|','|', ('state', '=', 'to_close'), ('is_locked', '=', False), ('reservation_state', 'not in', ('confirmed', 'waiting')), ('routing_id', '!=', False), ('reserved_check', '=', True)]}</attribute>
		  </xpath>



        	<xpath expr="//field[@name='company_id']" position="after">
        		<field name="project"/>
				<field name="production_cell" />
				<field name="order_seq"/>
        	</xpath>
        	<xpath expr="//field[@name='move_raw_ids']" position="replace">
                      <field name="move_raw_ids" context="{'final_lots': show_final_lots, 'tree_view_ref': 'mrp.view_stock_move_raw_tree', 'form_view_ref': 'mrp.view_stock_move_lots', 'default_location_id': location_src_id, 'default_location_dest_id': production_location_id, 'default_state': 'draft', 'default_raw_material_production_id': id, 'default_picking_type_id': picking_type_id}" attrs="{'readonly': ['&amp;', ('state', '!=', 'draft'), ('is_locked', '=', True)]}">
	                	<tree delete="0" default_order="is_done,sequence" decoration-muted="is_done" decoration-warning="quantity_done&gt;product_uom_qty" decoration-success="not is_done and quantity_done==product_uom_qty" decoration-danger="not is_done and reserved_availability &lt; product_uom_qty">
	                		<field name="storage_location_id" />
	                		<field name="product_id" required="1" string="Pecko Part Number"/>
	                		<field name="customer_part_no" />
                            <field name="name" />
							<field name="item_text" />
                            <field name="manufacturer_id" />
                            <field name="unit_factor" invisible="1"/>
                            <field name="product_uom" />
                            <field name="has_tracking" invisible="1"/>
                            <field name="needs_lots" invisible="1" readonly="1" groups="stock.group_production_lot"/>
                            <field name="is_done" invisible="1"/>
                            <field name="sequence" invisible="1"/>
                            <field name="location_id" invisible="1"/>
                            <field name="location_dest_id" domain="[('id', 'child_of', parent.location_dest_id)]" invisible="1"/>
                            <field name="state" invisible="1" force_save="1"/>
                            <field name="product_uom_qty" string="To Consume"/>
                            <field name="reserved_availability" attrs="{'invisible': [('is_done', '=', True)], 'column_invisible': [('parent.state', '=', 'done')]}" string="Reserved" />
                            <field name="quantity_done" string="Consumed" readonly="1"/>
                            <field name="to_consume_qty" string="To Consume" invisible="1" readonly="1"/>
	                	</tree>
	                </field>
			</xpath>
            <!-- <xpath expr="//field[@name='move_raw_ids']" position="replace">
				<group>
					<group string="To Consume">
						<field name="move_raw_ids" context="{'final_lots': show_final_lots, 'form_view_ref': 'mrp.view_stock_move_lots', 'default_location_id': location_src_id, 'default_location_dest_id': production_location_id, 'default_state': 'confirmed', 'default_raw_material_production_id': id}" attrs="{'readonly': [('is_locked', '=', True)]}" nolabel="1">
		                	<tree delete="0" default_order="is_done,sequence" decoration-muted="is_done" decoration-warning="quantity_done&gt;product_uom_qty" decoration-success="not is_done and quantity_done==product_uom_qty" decoration-danger="not is_done and reserved_availability &lt; product_uom_qty">
		                		<field name="product_id" required="1"/>
		                		<field name="manufacturer_id"/>
                                <field name="name" invisible="1"/>
                                <field name="unit_factor" invisible="1"/>
                                <field name="product_uom" invisible="1" groups="uom.group_uom"/>
                                <field name="has_tracking" invisible="1"/>
                                <field name="needs_lots" invisible="1" readonly="1" groups="stock.group_production_lot"/>
                                <field name="is_done" invisible="1"/>
                                <field name="sequence" invisible="1"/>
                                <field name="location_id" invisible="1"/>
                                <field name="location_dest_id" domain="[('id', 'child_of', parent.location_dest_id)]" invisible="1"/>
                                <field name="state" invisible="1" force_save="1"/>
                                <field name="product_uom_qty" invisible="1" string="To Consume"/>
                                <field name="reserved_availability" attrs="{'invisible': [('is_done', '=', True)], 'column_invisible': [('parent.state', '=', 'done')]}" string="Reserved" invisible="1"/>
                                <field name="quantity_done" string="Consumed" invisible="1" readonly="1"/>
                                <field name="to_consume_qty" string="To Consume"  readonly="1"/>
		                	</tree>
		                </field>
					</group>
					<group string="Consumed Products">
						<field name="consumed_move_raw_ids"  context="{'final_lots': show_final_lots, 'form_view_ref': 'mrp.view_stock_move_lots', 'default_location_id': location_src_id, 'default_location_dest_id': production_location_id, 'default_state': 'confirmed', 'default_raw_material_production_id': id}" attrs="{'readonly': [('is_locked', '=', True)]}" nolabel="1">
		                	<tree delete="0" default_order="is_done,sequence" decoration-muted="is_done" decoration-warning="quantity_done&gt;product_uom_qty" decoration-success="not is_done and quantity_done==product_uom_qty" decoration-danger="not is_done and reserved_availability &lt; product_uom_qty">
		                		<field name="product_id" required="1"/>
		                		<field name="manufacturer_id"/>
                                <field name="name" invisible="1"/>
                                <field name="unit_factor" invisible="1"/>
                                <field name="product_uom" invisible="1" groups="uom.group_uom"/>
                                <field name="has_tracking" invisible="1"/>
                                <field name="needs_lots" invisible="1" readonly="1" groups="stock.group_production_lot"/>
                                <field name="is_done" invisible="1"/>
                                <field name="sequence" invisible="1"/>
                                <field name="location_id" invisible="1"/>
                                <field name="location_dest_id" domain="[('id', 'child_of', parent.location_dest_id)]" invisible="1"/>
                                <field name="state" invisible="1" force_save="1"/>
                                <field name="product_uom_qty" invisible="1" string="To Consume"/>
                                <field name="reserved_availability" invisible="1" attrs="{'invisible': [('is_done', '=', True)], 'column_invisible': [('parent.state', '=', 'done')]}" string="Reserved"/>
                                <field name="quantity_done" string="Consumed" readonly="1"/>
		                	</tree>
		                </field>
		            </group>
				</group>            	
            </xpath> -->
            <!-- <xpath expr="//field[@name='finished_move_line_ids']" position="replace">
				<group>
					<group string="To Produce" attrs="{'readonly': [('is_locked', '=', True)], 'invisible': [('finished_move_line_ids', '=', [])]}">
						<field name="finished_move_line_ids" nolabel="1" context="{'form_view_ref': 'mrp.view_finisehd_move_line'}" attrs="{'readonly': [('is_locked', '=', True)], 'invisible': [('finished_move_line_ids', '=', [])]}">
	                        <tree default_order="done_move" editable="bottom" create="0" delete="0" decoration-muted="state in ('done', 'cancel')">
	                            <field name="product_id" readonly="1"/>
	                            <field name="lot_id" groups="stock.group_production_lot" domain="[('product_id', '=', product_id)]" context="{'default_product_id': product_id}" attrs="{'invisible': [('lots_visible', '=', False)]}"/>
	                            <field name="product_uom_id" invisible="1" groups="uom.group_uom"/>
	                            <field name="qty_to_produce"/>
	                            <field name="qty_done" invisible="1"/>
	                            <field name="lots_visible" invisible="1"/>
	                            <field name="done_move" invisible="1"/>
	                            <field name="state" invisible="1"/>
	                        </tree>
                        </field>
					</group>
					<group string="Produced Products" attrs="{'readonly': [('is_locked', '=', True)], 'invisible': [('finished_move_line_ids', '=', [])]}">
						<field name="finished_line_ids" nolabel="1" context="{'form_view_ref': 'mrp.view_finisehd_move_line'}" attrs="{'readonly': [('is_locked', '=', True)], 'invisible': [('finished_move_line_ids', '=', [])]}">
                        	<tree default_order="done_move" editable="bottom" create="0" delete="0" decoration-muted="state in ('done', 'cancel')">
	                        	<field name="product_id" readonly="1"/>
	                            <field name="lot_id" groups="stock.group_production_lot" domain="[('product_id', '=', product_id)]" context="{'default_product_id': product_id}" attrs="{'invisible': [('lots_visible', '=', False)]}"/>
	                            <field name="product_uom_id" invisible="1" groups="uom.group_uom"/>
	                            <field name="qty_done"/>
	                            <field name="lots_visible" invisible="1"/>
	                            <field name="done_move" invisible="1"/>
	                            <field name="state" invisible="1"/>
                        	</tree>
                    	</field>
		            </group>
				</group>            	
            </xpath> -->
        </field>
	</record>
	
	<record id="mrp_bom_form_inherit" model="ir.ui.view">
	    <field name="name">mrp.bom.form.inherit</field>
	    <field name="model">mrp.bom</field>
	    <field name="inherit_id" ref="mrp.mrp_bom_form_view"/>
	    <field name="arch" type="xml">
	        <xpath expr="//form[1]/sheet[1]/notebook[1]/page[1]/field[@name='bom_line_ids']/tree[1]/field[@name='product_id']" position="after">
	            <field name="customer_part_no"/>
	        </xpath>
	        <xpath expr="//form[1]/sheet[1]/notebook[1]/page[1]/field[@name='bom_line_ids']/tree[1]/field[@name='product_id']" position="attributes">
	            <attribute name="string">Pecko Part No</attribute>
	        </xpath>
	        <xpath expr="//form[1]/sheet[1]/notebook[1]/page[1]/field[@name='bom_line_ids']/tree[1]/field[@name='product_qty']" position="before">
	            <field name="item_text" />
				<field name="manufacturer_id"/>
	        </xpath>
<!-- 
	        <xpath expr="//field[@name='mobile']" position="attributes">
				<attribute name="required">True</attribute>
			</xpath> -->

	    </field>
	</record>    

	<!-- MRP 3 Step Location Auto Change -->
	<record model="ir.cron" id="mrp_3step_location_crons">
		<field name="name">MRP 3 Step Location Cron</field>
		<field name="model_id" ref="custom_mrp.model_mrp_production" />
		<field name="state">code</field>
		<field name="code">model.step_location_sync()</field>
		<field name="interval_number">30</field>
		<field name="interval_type">minutes</field>
		<field name="numbercall">-1</field>
		<field name="doall" eval="True"/>
	</record>

	
	  
</odoo>